<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R.D. Burman - Pancham Da Tribute</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Georgia, serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 25%, #48dbfb 50%, #ff9ff3 75%, #54a0ff 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #2c3e50;
        }
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .scrolling-header {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 0;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        .scrolling-track {
            display: flex;
            animation: scroll 30s linear infinite;
            width: fit-content;
        }
        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .scrolling-image {
            height: 80px;
            width: auto;
            margin: 0 15px;
            border-radius: 10px;
            border: 3px solid #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; position: relative; z-index: 2; }
        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }
        .main-video-container {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 8px solid #ff6b6b;
            margin: 20px auto;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        .main-video { width: 100%; height: 100%; object-fit: cover; }
        h1 {
            font-size: 3.5rem;
            color: #e74c3c;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
            margin: 20px 0;
        }
        .dates {
            font-size: 1.3rem;
            color: #34495e;
            font-weight: bold;
            padding: 10px 20px;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            display: inline-block;
            border-radius: 20px;
            margin: 15px 0;
        }
        .subtitle { font-size: 1.5rem; color: #8e44ad; font-style: italic; margin-top: 10px; }
        nav {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .tab-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .tab-btn:nth-child(1) { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .tab-btn:nth-child(2) { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .tab-btn:nth-child(3) { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .tab-btn:nth-child(4) { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; }
        .tab-btn.active { transform: scale(1.1); }
        .tab-content { display: none; background: rgba(255, 255, 255, 0.95); padding: 40px; border-radius: 20px; }
        .tab-content.active { display: block; }
        .home-summary { line-height: 1.8; font-size: 1.15rem; }
        .home-summary h2 { color: #8e44ad; font-size: 2.2rem; margin-bottom: 20px; text-align: center; }
        .home-summary .highlight { background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); padding: 20px; border-radius: 15px; margin: 25px 0; }
        .folder-item {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        .folder-item:hover { transform: translateX(5px); }
        .song-item {
            background: white;
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            gap: 10px;
            align-items: center;
            transition: background 0.2s;
        }
        .song-item:hover { background: #f8f9fa; }
        .content-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin-top: 30px; }
        .content-card { background: white; padding: 25px; border-radius: 15px; border-left: 5px solid #e74c3c; }
        .video-embed { width: 100%; aspect-ratio: 16/9; border-radius: 10px; }
        .loading { text-align: center; padding: 40px; }
        .spinner { border: 5px solid #f3f3f3; border-top: 5px solid #e74c3c; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .audio-player-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 15px 20px;
            z-index: 1000;
            display: none;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
        }
        .audio-player-container.active { display: block; }
        footer { text-align: center; padding: 30px; margin-top: 50px; background: rgba(255, 255, 255, 0.9); border-radius: 20px; }
    </style>
</head>
<body>
    <div class="scrolling-header">
        <div class="scrolling-track" id="scrollingTrack"></div>
    </div>

    <div class="container">
        <header>
            <div class="main-video-container">
                <video class="main-video" autoplay loop muted playsinline>
                    <source src="images/RD.mp4" type="video/mp4">
                </video>
            </div>
            <h1>R.D. BURMAN</h1>
            <div class="subtitle">üéµ Pancham Da - The Musical Genius üé∂</div>
            <div class="dates">27 June 1939 - 4 January 1994</div>
            <p style="margin-top: 20px; font-size: 1.2rem;">"The Innovator who Revolutionized Bollywood Music"</p>
        </header>

        <nav>
            <button class="tab-btn active" onclick="showTab(event, 'home')">üè† Home</button>
            <button class="tab-btn" onclick="showTab(event, 'video')">üìπ Video</button>
            <button class="tab-btn" onclick="showTab(event, 'audio')">üéß Audio</button>
            <button class="tab-btn" onclick="showTab(event, 'about')">üìñ His Life</button>
        </nav>

        <div id="home" class="tab-content active">
            <div class="home-summary">
                <h2>üéº Welcome to Pancham Da's Musical Legacy</h2>
                <p>Rahul Dev Burman, known as <strong>Pancham Da</strong>, was born on 27th June 1939 in Calcutta. His nickname came from a legend ‚Äì his baby cries resonated with the fifth note (Pa) of the Indian musical scale!</p>
                <div class="highlight">
                    <strong>Born into Musical Royalty:</strong> Son of Sachin Dev Burman, he composed his first song at age nine for <em>Funtoosh</em> (1956).
                </div>
                <p>Pancham Da orchestrated a revolution! He brought rock, jazz, and electronic sounds into Bollywood. His collaboration with Asha Bhosle, Kishore Kumar, and Lata Mangeshkar produced immortal melodies.</p>
                <div class="highlight">
                    <strong>The Numbers:</strong> <strong>331 films</strong> - 292 in Hindi, 31 in Bengali. From "Mehbooba Mehbooba" to "Tere Bina Zindagi Se."
                </div>
            </div>
        </div>

        <div id="video" class="tab-content">
            <h2 style="color: #e74c3c; font-size: 2.5rem; margin-bottom: 30px;">üìπ Video Collection</h2>
            <div id="videoContent" class="content-grid">
                <div class="loading"><div class="spinner"></div><p>Loading videos...</p></div>
            </div>
        </div>

        <div id="audio" class="tab-content">
            <h2 style="color: #8e44ad; font-size: 2.5rem; margin-bottom: 30px;">üéß Audio Collection</h2>
            <div id="audioTreeContent">
                <div class="loading"><div class="spinner"></div><p>Loading audio collection...</p></div>
            </div>
        </div>

        <div id="about" class="tab-content">
            <h2 style="color: #8e44ad; font-size: 2.5rem; margin-bottom: 30px;">üìñ About Pancham Da</h2>
            <div style="line-height: 2; font-size: 1.2rem;">
                <p>Rahul Dev Burman was born on 27th June 1939 in Calcutta. Born into a royal lineage of music, he was destined for greatness. Over his career, he composed scores for 331 films, bringing rock 'n' roll, jazz, and electronic sounds into Bollywood.</p>
            </div>
        </div>

        <footer>
            <p>"Pancham Da's music transcends time, touching hearts across generations."</p>
            <p style="margin-top: 20px; font-weight: bold; color: #e74c3c;">üéµ Forever in our hearts - R.D. Burman (1939-1994) üé∂</p>
        </footer>
    </div>

    <div class="audio-player-container" id="audioPlayerContainer">
        <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; gap: 15px; color: white;">
            <div id="nowPlaying" style="flex: 1; font-size: 1.1rem; font-weight: bold;">üéµ No song playing</div>
            <audio id="audioPlayer" controls style="flex: 2; max-width: 600px;"></audio>
        </div>
    </div>

    <script>
        const API_BASE_URL = window.location.origin + '/api';
        const driveFolders = [
            { id: '1', name: '2 Songs on Same Tune', folderId: '1jkelYsCvDvFfR9jrGv1-WjHK6DRJZgo1' },
            { id: '2', name: 'A to M', folderId: '16ejKARRUctUYiSmGpXUjztIpbUeaLVQ3' },
            { id: '3', name: 'Asha && R.D_Bangla', folderId: '15W7_4PUUYRSxntCn7EUg95wETL0Alzsa' },
            { id: '4', name: 'Gulzar_Asha_RD', folderId: '1vbTX12RNbNJSHNXenJ-es805NslwEClv' },
            { id: '5', name: 'N to Z', folderId: '1X0oZNmsd_MFCEkDXeZCHdfFsqsVJ1Auy' },
            { id: '6', name: 'Pancham - Gulzar Remembers', folderId: '1UPxZ-4s5nSEjrjquqH5GkkG4u95LRf9g' }
        ];

        function showTab(e, n) {
            if(e) e.preventDefault();
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(n).classList.add('active');
            if(e && e.currentTarget) e.currentTarget.classList.add('active');
            if(n === 'video' && !document.getElementById('videoContent').dataset.loaded) loadVideos();
            if(n === 'audio' && !document.getElementById('audioTreeContent').dataset.loaded) loadAudio();
        }

        async function loadAudio() {
            const c = document.getElementById('audioTreeContent');
            if(!c) return;
            c.innerHTML = '<div id="audioContainer" style="padding:20px"></div>';
            c.dataset.loaded = 'true';
            showMainFolders();
        }

        function showMainFolders() {
            const t = document.getElementById('audioContainer');
            if(!t) return;
            t.innerHTML = '';
            for(const f of driveFolders) {
                const d = document.createElement('div');
                d.className = 'folder-item';
                d.innerHTML = `<div><span>üìÅ</span> ${f.name}</div><span>‚ñ∂</span>`;
                d.onclick = () => loadFolderContents(f.folderId, f.name);
                t.appendChild(d);
            }
        }

        async function loadFolderContents(folderId, folderName, parentPath = '') {
            const container = document.getElementById('audioContainer');
            if(!container) return;
            
            // Clear container and show loading
            container.innerHTML = `
                <div class="folder-item" onclick="showMainFolders()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; cursor: pointer;">
                    <div><span>‚óÄ</span> Back to Folders</div>
                </div>
                <div style="padding: 20px; text-align: center; font-size: 1.5rem; color: #8e44ad; font-weight: bold;">
                    üìÇ ${folderName}
                </div>
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading contents...</p>
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE_URL}/drive/folder-contents/${folderId}`);
                const data = await response.json();
                
                // Remove loading spinner
                const loadingDiv = container.querySelector('.loading');
                if(loadingDiv) loadingDiv.remove();
                
                if(!data.success) {
                    container.innerHTML += `
                        <div style="padding: 20px; text-align: center; color: #e74c3c;">
                            ‚ùå Error: ${data.error}
                        </div>
                    `;
                    return;
                }

                // Display subfolders with image placeholders
                if(data.folders && data.folders.length > 0) {
                    data.folders.forEach(subfolder => {
                        const subDiv = document.createElement('div');
                        subDiv.className = 'folder-item';
                        subDiv.style.background = 'linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%)';
                        subDiv.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                                    üéµ
                                </div>
                                <div>
                                    <div style="font-weight: bold; font-size: 1.1rem;">üìÇ ${subfolder.name}</div>
                                    <div style="font-size: 0.9rem; opacity: 0.8;">Click to view songs</div>
                                </div>
                            </div>
                            <span style="font-size: 1.5rem;">‚ñ∂</span>
                        `;
                        subDiv.onclick = (e) => {
                            e.stopPropagation();
                            loadFolderContents(subfolder.id, subfolder.name, `${parentPath}/${folderName}`);
                        };
                        container.appendChild(subDiv);
                    });
                }

                // Display audio files
                if(data.audioFiles && data.audioFiles.length > 0) {
                    const audioHeader = document.createElement('div');
                    audioHeader.style.cssText = 'padding: 20px 0 10px 0; font-size: 1.3rem; font-weight: bold; color: #e74c3c;';
                    audioHeader.innerHTML = 'üéß Songs (' + data.audioFiles.length + ')';
                    container.appendChild(audioHeader);

                    data.audioFiles.forEach(audio => {
                        const audioDiv = document.createElement('div');
                        audioDiv.className = 'song-item';
                        audioDiv.innerHTML = `
                            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; flex-shrink: 0;">
                                üéµ
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${audio.name}</div>
                                <div style="font-size: 0.85rem; color: #666;">${audio.extension ? audio.extension.toUpperCase() : 'MP3'} ${audio.size ? '‚Ä¢ ' + formatFileSize(audio.size) : ''}</div>
                            </div>
                            <button onclick="playAudio('${audio.id}', '${audio.name.replace(/'/g, "\\'")}', event)" 
                                    style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                                ‚ñ∂ Play
                            </button>
                        `;
                        container.appendChild(audioDiv);
                    });
                } else if(!data.folders || data.folders.length === 0) {
                    const emptyDiv = document.createElement('div');
                    emptyDiv.style.cssText = 'padding: 40px; text-align: center; color: #999; font-size: 1.2rem;';
                    emptyDiv.innerHTML = 'üì≠ No audio files found in this folder';
                    container.appendChild(emptyDiv);
                }
            } catch(error) {
                const loadingDiv = container.querySelector('.loading');
                if(loadingDiv) loadingDiv.remove();
                container.innerHTML += `
                    <div style="padding: 20px; text-align: center; color: #e74c3c;">
                        ‚ùå Error loading folder: ${error.message}
                    </div>
                `;
            }
        }

        function formatFileSize(bytes) {
            if(!bytes) return '';
            const mb = bytes / (1024 * 1024);
            return mb.toFixed(1) + ' MB';
        }

        function playAudio(fileId, fileName, event) {
            event.stopPropagation();
            const player = document.getElementById('audioPlayer');
            const container = document.getElementById('audioPlayerContainer');
            const nowPlaying = document.getElementById('nowPlaying');
            
            // Show player with loading state
            nowPlaying.textContent = '‚è≥ Loading: ' + fileName;
            container.classList.add('active');
            
            // Use our backend proxy endpoint for streaming
            const streamUrl = `${API_BASE_URL}/drive/stream/${fileId}`;
            
            player.src = streamUrl;
            player.load();
            
            // Add event listeners for better UX
            player.onloadeddata = () => {
                nowPlaying.textContent = 'üéµ Now Playing: ' + fileName;
                player.play().catch(err => {
                    console.error('Play error:', err);
                    nowPlaying.textContent = '‚ùå Error: ' + fileName;
                });
            };
            
            player.onerror = (e) => {
                console.error('Audio error:', e);
                nowPlaying.textContent = '‚ùå Failed to load: ' + fileName;
            };
            
            player.onended = () => {
                nowPlaying.textContent = '‚úÖ Finished: ' + fileName;
            };
            
            player.onpause = () => {
                if (player.currentTime > 0 && player.currentTime < player.duration) {
                    nowPlaying.textContent = '‚è∏Ô∏è Paused: ' + fileName;
                }
            };
            
            player.onplay = () => {
                nowPlaying.textContent = 'üéµ Playing: ' + fileName;
            };
        }

        async function loadVideos() {
            const v = document.getElementById('videoContent');
            if(!v) return;
            v.dataset.loaded = 'true';
            try {
                const r = await fetch(`${API_BASE_URL}/youtube/search`);
                const d = await r.json();
                if(d.success && d.videos) {
                    v.innerHTML = d.videos.slice(0,12).map(vid => `
                        <div class="content-card">
                            <h3>üé¨ ${vid.snippet.title.substring(0,60)}...</h3>
                            <iframe class="video-embed" src="https://www.youtube.com/embed/${vid.id.videoId}" frameborder="0" allowfullscreen></iframe>
                        </div>
                    `).join('');
                } else {
                    v.innerHTML = '<p>No videos found</p>';
                }
            } catch(e) {
                v.innerHTML = '<p>Error loading videos</p>';
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            fetch('/api/images/list').then(r => r.json()).then(d => {
                if(d.success && d.images) {
                    const t = document.getElementById('scrollingTrack');
                    [...d.images, ...d.images].forEach(n => {
                        const i = document.createElement('img');
                        i.src = `images/${n}`;
                        i.className = 'scrolling-image';
                        i.onerror = () => i.style.display = 'none';
                        t.appendChild(i);
                    });
                }
            }).catch(() => {});
        });
    </script>
</body>
</html>